!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Vuelite=t()}(this,(function(){"use strict";function e(e,t,s){t=t.trim();let n=e;t.split(/[.[\]]/).filter(Boolean).forEach(((e,t,i)=>{if(t===i.length-1)n[e]=s;else if(/^\d+$/.test(e)){if(!Array.isArray(n))return;n=n[+e]}else{if(!Object.hasOwn(n,e))return;n=n[e]}}))}function t(e){const t=document.createDocumentFragment();let s;for(;s=e.firstChild;)t.appendChild(s);return t}function s(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}const n=e=>"object"===s(e)||"array"===s(e);function i(e){return/{{\s*.*?\s*}}/.test(e)}function r(e){if(e instanceof HTMLElement)return e.tagName.includes("-")}function o(e){return e instanceof HTMLElement&&e.isComponent}class c{constructor(e){this.key=e,this.listener=new Set}subscribe(e){this.listener.add(e)}unsubscribe(e){this.listener.delete(e)}notify(){this.listener.forEach((e=>{e.isMethods||e.update()}))}depend(){var e;null===(e=c.activated)||void 0===e||e.addDep(this)}}c.activated=null;class a{static getStore(){return this.globalDeps}static addStore(e){this.globalDeps.push(e)}static forceUpdate(){this.globalDeps.forEach((e=>{for(const t of e.values())t.notify()}))}static addObserver(e){this.globalObservers.push(e)}static updateMethods(){this.globalObservers.forEach((e=>{e.isMethods&&e.update()}))}}a.globalDeps=[],a.globalObservers=[];class l{constructor(e){this.proxy=this.define(e)}define(e){const t=this,i=new Map,r=new Map;a.addStore(r);return new Proxy(e,{get(e,o,a){if("symbol"===s(o))return Reflect.get(e,o,a);r.has(o)||r.set(o,new c(o)),r.get(o).depend();const l=e[o];return n(l)?(i.has(o)||i.set(o,t.define(l)),i.get(o)):Reflect.get(e,o,a)},set(e,t,s,n){const i=e._length,o=Reflect.set(e,t,s,n);return i!==e._length&&r.has("_length")&&r.get("_length").notify(),r.has(t)&&r.get(t).notify(),o},deleteProperty(e,t){const s=e._length,n=Reflect.deleteProperty(e,t);return s!==e._length&&r.has("_length")&&r.get("_length").notify(),n}})}}function h(e){const{data:t,props:n}=e.$options,i=(e=>"function"===s(e))(t)?t():{},r=new l(i).proxy;Object.defineProperty(e,"$data",{get:()=>r});for(const t in i)36!==t.charCodeAt(0)&&Object.defineProperty(e,t,{configurable:!1,get:()=>r[t],set:e=>{r[t]=e}});if(n){const t=function(e){return e.reduce(((e,t)=>(e[t]=void 0,e)),{})}(n),s=new l(t).proxy;Object.defineProperty(e,"$props",{get:()=>s});for(const n in t)Object.defineProperty(e,n,{configurable:!1,get:()=>s[n],set:e=>{}})}!function(e){const{methods:t}=e.$options;if(!t)return;Object.entries(t).forEach((([t,s])=>{if(Object.hasOwn(e,t))throw new Error(`${t} has already been declared`);Object.defineProperty(e,t,{value:(...t)=>s.apply(e,t)})}))}(e),function(e){const{computed:t}=e.$options;if(!t)return;for(const s in t)if(Object.hasOwn(e,s))throw new Error(`${s} has already been declared`);Object.entries(t).forEach((([t,s])=>{const n={};!function(e){return"function"!=typeof e}(s)?n.get=()=>s.call(e):(n.get=s.get.bind(e),n.set=(...t)=>{s.set.apply(e,t)}),Object.defineProperty(e,t,n)}))}(e)}class d{constructor(e){const t=e.cssRules.length;e.insertRule("*{}",t),this.rule=e.cssRules[t]}selector(e){this.rule.selectorText=e}setStyle(e,t){this.rule.style[e]=t}}function u(e){const{styles:t,scopedStyles:s}=e.$options;if(t||s){if(t){const e=document.createElement("style");document.head.appendChild(e),Object.entries(t).forEach((([t,s])=>{const n=new d(e.sheet);n.selector(t),Object.entries(s).forEach((([e,t])=>{n.setStyle(e,t)}))}))}if(s){const t=document.createElement("style");document.head.appendChild(t);const n="v-"+Math.random().toString(36).substring(2,7);Object.entries(s).forEach((([e,s])=>{const i=`${e}[data-scopeid="${n}"], *[data-scopeid="${n}"] ${e}`,r=new d(t.sheet);r.selector(i),Object.entries(s).forEach((([e,t])=>{r.setStyle(e,t)}))})),e.$el instanceof HTMLElement?e.$el.setAttribute("data-scopeid",n):e.$el instanceof DocumentFragment&&Array.from(e.$el.children).forEach((e=>{e.setAttribute("data-scopeid",n)}))}}}const p=["bind","model","text","style","class","html","on","if","show","for"];function f(e){const t=/{{\s*(.*?)\s*}}/g,s=[];let n;for(;null!==(n=t.exec(e));)s.push(n[1]);return s}function m(e){return e.startsWith("v-")||e.startsWith(":")||e.startsWith("@")}function b(e,t){if(o(t))return"Component";if((e=>1===e.nodeType)(t)){const s=t.attributes,n=s.getNamedItem("ref");if(n&&(e.$refs[n.value]=t),Array.from(s).some((e=>m(e.name))))return"Directive"}else if((e=>3===e.nodeType)(t)&&i(t.textContent)&&!(e=>{const t=null==e?void 0:e.attributes;if(t)return Array.from(t).some((e=>"v-text"===e.name))})(t.parentElement)){if(f(t.textContent||"").length>0)return"Template"}}const g={text(e,t){e.textContent=t},class(e,t){n(t)&&Object.entries(t).forEach((([t,s])=>{s&&e.classList.add(t)}))},style(e,t){for(const[n,i]of Object.entries(t))/^["'].*["']$/.test(s=i)&&s[0]===s[s.length-1]?e.style[n]=i.slice(1,-1):e.style[n]=i;var s},html(e,t){e.innerHTML=t},inputCheckbox(e,t){e.checked=t},inputRadio(e,t){e.checked=e.value===t},inputValue(e,t){e.value=t},inputMultiple(e,t){const s=Array.from(e.options);Array.isArray(t)&&s.forEach((e=>{e.selected=t.includes(e.value)}))},customBind(e,t){null!=t&&e.setAttribute(this.modifier,t)},objectBind(e,t){n(t)&&Object.entries(t).forEach((([t,s])=>e.setAttribute(t,s)))},show(e,t){e.style.display=t?"":"none"}};function v(e,t){try{return new Function(`\n      with (this) {\n        return ${t};\n      }\n    `).call(e)}catch(e){return}}function y(e,t){return i(t)?function(e,t){const s=f(t).reduce(((t,s)=>("()"===s.slice(-2)&&(c.activated.isMethods=!0),t[s]=v(e,s),t)),{});return t.replace(/{{\s*(.*?)\s*}}/g,((e,t)=>{var n;return null!==(n=s[t])&&void 0!==n?n:""}))}(e,t):v(e,t)}class x{constructor(e,t,s,n){var i;if(this.vm=e,this.exp=t,this.onUpdate=s,this.deps=new Set,this.isMethods=!1,a.addObserver(this),this.value=this.getterTrigger(),n){null!==(i=n.immediate)&&void 0!==i&&i&&s(this.value)}else s(this.value)}addDep(e){e.subscribe(this),this.deps.add(e)}getterTrigger(){c.activated=this;const e=y(this.vm,this.exp);return n(e)&&e._length,c.activated=null,e}update(){const e=this.value,t=this.getterTrigger();var s;(s=t)!==Object(s)&&e===t||(this.value=t,this.isMethods?this.onUpdate(t,e):this.vm.updateQueue.push((()=>this.onUpdate(t,e))))}}function E(e){const{watch:t}=e.$options;t&&Object.entries(t).forEach((([t,n])=>{if(function(e){return"function"===s(e)}(n))new x(e,t,n,{immediate:!1});else{const{handler:s,...i}=n;new x(e,t,s,i)}}))}class ${constructor(e,t,s){this.vm=e,this.el=t,this.exp=s,this.parent=t.parentElement||e.$el,this.childIndex=Array.from(this.parent.children).indexOf(t),this.ifFragment=document.createDocumentFragment(),this.checkForElse(),this.render()}render(){new x(this.vm,this.exp,((e,t)=>{this.updater(e)}))}checkForElse(){const e=this.el.nextElementSibling;(null==e?void 0:e.hasAttribute("v-else"))&&(this.elseElement=e,this.elseFragment=document.createDocumentFragment())}updater(e){if(e){const e=this.parent.children[this.childIndex];this.parent.insertBefore(this.ifFragment,e),this.elseElement&&this.elseFragment.appendChild(this.elseElement)}else if(this.ifFragment.appendChild(this.el),this.elseElement){const e=this.parent.children[this.childIndex];this.parent.insertBefore(this.elseFragment,e)}}}class w{visit(e,t){let s;const n=[t.firstChild];for(;s=n.pop();)if(s){if((i=s)instanceof HTMLElement&&i.hasAttribute("v-for")){e(s),s.nextSibling&&n.push(s.nextSibling);continue}e(s),s.firstChild&&n.push(s.firstChild),s.nextSibling&&n.push(s.nextSibling)}var i}}function C(e,t,n,i){if("object"===s(i)){const s=Object.keys(i)[n];switch(e.length){case 1:return{[e[0]]:`${t}.${s}`};case 2:return{[e[0]]:`${t}.${s}`,[e[1]]:`"${s}"`};case 3:return{[e[0]]:`${t}.${s}`,[e[1]]:`"${s}"`,[e[2]]:n};default:return{}}}else if("number"===s(i))switch(e.length){case 1:return{[e[0]]:n+1};case 2:return{[e[0]]:n+1,[e[1]]:n};default:return{}}else switch(e.length){case 1:return{[e[0]]:`${t}[${n}]`};case 2:return{[e[0]]:`${t}[${n}]`,[e[1]]:n};default:return{}}}function k(e,t){return e?(Object.keys(e).forEach((s=>{const n=new RegExp(`\\b${s}\\b`,"g");t=t.replace(n,e[s])})),t):t}class O{constructor(e,t){this.loop=e,this.data=t,this.scanner=new L(new w)}bind(e,t){const{alias:s,vm:n,loopEffects:i,listExp:r,parentContext:o}=this.loop,c={...o,...C(s,r,t,this.data)};F.context=c;const a=this.scanner.scanPartial(n,e,i);return F.context=null,a}}class T{constructor(e,t,s,n){this.vm=e,this.el=t,this.exp=s,this.parentContext=n,this.loopEffects=[],this.parent=t.parentElement||e.$el,this.startIndex=Array.from(this.parent.children).indexOf(t);const i=function(e){let t=e.match(/^(.+?)\s+in\s+(.+)$/);return t?{key:t[1],list:t[2]}:(t=e.match(/^(.+?)\s+of\s+(.+)$/),t?{key:t[1],list:t[2]}:null)}(this.exp);if(!i)return;const{key:r,list:o}=i;this.listExp=o,this.alias=function(e){const t=e.match(/\(([^)]+)\)/);return t?t[1].split(",").map((e=>e.trim())).filter((e=>e)):[e]}(r),this.render()}render(){new x(this.vm,this.listExp,((e,t)=>{this.updater(e)}))}updater(e){const t=document.createDocumentFragment(),n=function(e){switch(s(e)){case"string":case"array":return e.length;case"object":return Object.values(e).length;case"number":return Math.max(0,Number(e));default:return 0}}(e),i=this.startIndex+n-1,r=new O(this,e);if(Array.from({length:n}).forEach(((e,s)=>{const n=this.el.cloneNode(!0);var i;(i=n).removeAttribute("v-for"),i.removeAttribute(":key"),i.removeAttribute("v-bind:key");const o=r.bind(n,s);t.appendChild(o)})),this.el.isConnected)this.parent.replaceChild(t,this.el),this.endIndex=i;else{for(let e=this.endIndex;e>=this.startIndex;e--){const t=this.parent.children[e];t&&this.parent.removeChild(t)}this.el.remove();const e=this.parent.children[this.startIndex];this.parent.insertBefore(t,e),this.endIndex=this.startIndex+n-1}this.clearEffects()}clearEffects(){this.loopEffects.forEach((e=>e())),this.loopEffects=[]}}class j{constructor(e,t,s,n,i){this.vm=t,this.node=s,this.exp=n;const{key:r,modifier:o}=function(e){if([":","@"].includes(e[0]))return":"===e.slice(0,1)?{key:"bind",modifier:e.slice(1)}:{key:"on",modifier:e.slice(1)};{const t=/^v-([\w-]+)(:(\w+))?$/,s=e.match(t);return{key:s[1],modifier:s[3]||null}}}(e);this.name=r,this.modifier=o,(e=>p.includes(e))(r)&&(((e,t)=>e.startsWith("else")||"bind"===e&&"key"===t)(r,o)||(!function(e){return"if"===e||"for"===e}(r)?(!function(e){return e.startsWith("v-on:")||e.startsWith("@")}(e)?this[r]():this.on(),s instanceof HTMLElement&&s.removeAttribute(e)):this.scheduleTask(r,i)))}bind(e){e=this.selectUpdater(e),new x(this.vm,this.exp,((t,s)=>{if(o(this.node)){const e=this.vm.$components.get(this.node)||F.globalComponents.get(this.node);e.$parent=this.vm,e.$props[this.modifier]=t}else e(this.node,t)}))}model(){const t=this.node;switch(t.tagName){case"INPUT":{const s=t;"checkbox"===s.type?(s.addEventListener("change",(t=>{const s=t.target.checked;e(this.vm,this.exp,s)})),this.bind(g.inputCheckbox)):"radio"===s.type?(s.name=this.exp,s.addEventListener("change",(t=>{const s=t.target.value;e(this.vm,this.exp,s)})),this.bind(g.inputRadio)):(s.addEventListener("input",(t=>{const s=t.target.value;e(this.vm,this.exp,s)})),this.bind(g.inputValue));break}case"TEXTAREA":t.addEventListener("input",(t=>{const s=t.target.value;e(this.vm,this.exp,s)})),this.bind(g.inputValue);break;case"SELECT":{const s=t;s.multiple?(s.addEventListener("change",(t=>{const s=t.target,n=Array.from(s.selectedOptions).map((e=>e.value));e(this.vm,this.exp,n)})),this.bind(g.inputMultiple)):(s.addEventListener("change",(t=>{const s=t.target.value;e(this.vm,this.exp,s)})),this.bind(g.inputValue));break}default:throw new Error(`Unsupported element type: ${t.tagName}`)}}text(){this.bind(g.text.bind(this))}style(){this.bind(g.style)}class(){this.bind(g.class)}html(){this.bind(g.html)}show(){this.bind(g.show)}on(){const e=(t=this.vm,this.exp.trim().split(".").reduce(((e,t)=>e&&Object.hasOwn(e,t)?e[t]:null),t));var t;if("function"==typeof e)this.node.addEventListener(this.modifier,e);else{const e=v(this.vm,`function(){ ${this.exp} }`);this.node.addEventListener(this.modifier,e)}}scheduleTask(e,t){const s={...F.context},n="if"===e?$:T,i=()=>new n(this.vm,this.node,this.exp,s);t?t.push(i):this.vm.deferredTasks.push(i)}selectUpdater(e){const t=this.modifier;return"text"===t||"class"===t||"style"===t?g[t].bind(this):e||(t?g.customBind.bind(this):g.objectBind.bind(this))}}class A{constructor(e,t,s,n){switch(this.vm=e,this.node=t,this.loopEffects=n,s){case"Component":case"Directive":this.directiveBind(t);break;case"Template":this.templateBind(t)}}directiveBind(e){Array.from(e.attributes).forEach((({name:t,value:s})=>{if(m(t)){s=k(F.context,s),new j(t,this.vm,e,s,this.loopEffects)}}))}templateBind(e){let t=e.textContent;t=k(F.context,t),new j("v-text",this.vm,e,t)}}class M{constructor(e){this.visitor=e}visit(e,t){this.visitor.visit(e,t)}}class L extends M{scan(e){const s=t=>{r(t)&&this.replaceComponent(e,t);const s=b(e,t);s&&new A(e,t,s)};this.fragment=t(e.$el),s(this.fragment),this.visit(s,this.fragment),e.$el.appendChild(this.fragment),e.clearTasks()}scanPartial(e,s,n){const i=t(s),o=t=>{r(t)&&this.replaceComponent(e,t,n);const s=b(e,t);s&&new A(e,t,s,n)};return o(i),this.visit(o,i),s.appendChild(i),s}replaceComponent(e,t,s){const n=e.$components.get(t)||F.globalComponents.get(t);if(n)e.deferredTasks.push((()=>{var e;return null===(e=t.parentNode)||void 0===e?void 0:e.replaceChild(n.$el,t)})),t.isComponent=!0;else{const n=e.componentsNames[t.tagName]||F.globalComponentsNames[t.tagName];if(n){t.isComponent=!0;const i=new F(n);e.componentsNames[t.tagName]?e.$components.set(t,i):F.globalComponents.set(t,i);const r=()=>{var e;return null===(e=t.parentNode)||void 0===e?void 0:e.replaceChild(i.$el,t)};s?s.push(r):e.deferredTasks.push(r)}}}}class N{constructor(){this.deferredTasks=[]}setHooks(e){this.hooks=e}callHook(e){const t=this.hooks[e];"function"===s(t)&&("beforeCreate"===e?t.call(null):t.call(this))}clearTasks(){this.deferredTasks.forEach((e=>e())),this.deferredTasks=[]}}class S extends N{constructor(e){super(),this.$props={},this.$parent=null,this.$refs={},this.$components=new Map,this.componentsNames={},this.updateQueue=[],this.$options=e,this.setHooks(this.$options),this.setupDOM(e),this.localComponents(e),this.callHook("beforeCreate"),h(this),u(this),E(this),this.callHook("created");new L(new w).scan(this),this.callHook("mounted"),requestAnimationFrame((()=>this.render()))}setupDOM(e){if(e.template)this.$el=function(e){if(!e)return;const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}(e.template);else{const t=document.querySelector(e.el);!function(e){return e instanceof HTMLTemplateElement}(t)?this.$el=t:this.$el=t.content.cloneNode(!0)}}render(){if(this.updateQueue.length>0){for(this.callHook("beforeUpdate");this.updateQueue.length>0;){const e=this.updateQueue.shift();"function"===s(e)&&e()}a.updateMethods(),this.callHook("updated")}requestAnimationFrame((()=>this.render()))}$watch(e,t,s){new x(this,e,t,s)}$forceUpdate(){a.forceUpdate()}localComponents(e){const{components:t}=e;t&&Object.entries(t).forEach((([e,t])=>{this.componentsNames[e.toUpperCase()]=t,Array.from(document.querySelectorAll(e)).forEach((e=>{this.$components.set(e,new S(t))}))}))}static component(e,t){this.globalComponentsNames[e.toLocaleUpperCase()]=t,Array.from(document.querySelectorAll(e)).forEach((e=>{this.globalComponents.set(e,new S(t))}))}}S.globalComponentsNames={},S.globalComponents=new Map;var F=S;return F}));
