const t=t=>{return"object"===(e=t,Object.prototype.toString.call(e).slice(8,-1).toLowerCase());var e};function e(t){return/^["'].*["']$/.test(t)&&t[0]===t[t.length-1]}const s=t=>1===t.nodeType,n=t=>3===t.nodeType;function i(t){const e=/{{\s*(.*?)\s*}}/g,s=[];let n;for(;null!==(n=e.exec(t));)s.push(n[1]);return s}function r(t){return 0===t.indexOf("v-")}const o={text(t,e){var s;s=this.template,/{{\s*[^{}\s]+\s*}}/.test(s)?t.textContent=((t,e,s)=>{const n=new RegExp(`{{\\s*${i=e,i.replace(/[()]/g,"\\$&")}\\s*}}`,"g");var i;return t.replace(n,s)})(this.template,this.exp,e):t.textContent=e},class(e,s){t(s)&&Object.entries(s).forEach((([t,s])=>{s&&e.classList.add(t)}))},style(t,s){for(const[n,i]of Object.entries(s))e(i)?t.style[n]=i.slice(1,-1):t.style[n]=i},html(t,e){t.innerHTML=e},inputCheckbox(t,e){t.checked=e},inputRadio(t,e){t.checked=t.value===e},inputValue(t,e){t.value=e},inputMultiple(t,e){const s=Array.from(t.options);Array.isArray(e)&&s.forEach((t=>{t.selected=e.includes(t.value)}))},customBind(t,e){t.setAttribute(this.modifier,e)},objectBind(e,s){t(s)&&Object.entries(s).forEach((([t,s])=>e.setAttribute(t,s)))}};function c(t,e){return(e=e.trim()).split(".").reduce(((t,e)=>t&&Object.hasOwn(t,e)?t[e]:null),t)}function a(t,e,s){e=e.trim();let n=t;e.split(".").forEach(((t,e,i)=>{if(e===i.length-1)n[t]=s;else{if(!Object.hasOwn(n,t))return;n=n[t]}}))}function l(t,s){let n;if(/^\{(\s*[a-zA-Z_$][a-zA-Z_$0-9]*\s*:\s*[^{}]+\s*,?\s*)+\}$/.test(s)){const i=JSON.parse(function(t){return t.replace(/(\w+):/g,'"$1":').replace(/:\s*([^,\s{}]+)/g,((t,e)=>/^".*"$/.test(e)?t:`: "${e}"`))}(s));n=Object.entries(i).reduce(((s,[n,i])=>(e(i)?s[n]=function(t){return"true"===t||"false"!==t&&t}(i.slice(1,-1)):s[n]=c(t,i),s)),i)}else{const e=function(t){const e=t.match(/^\s*(\w+(\.\w+)*)\(\)\s*$/);return e?e[1]:null}(s);n=e?c(t,e).call(t):c(t,s)}return n}class h{constructor(){this.listener=new Set}subscribe(t){this.listener.add(t)}unsubscribe(t){this.listener.delete(t)}notify(){this.listener.forEach((t=>{t.update()}))}depend(){var t;null===(t=h.activated)||void 0===t||t.addDep(this)}}h.activated=null;class d{constructor(t,e,s){this.vm=t,this.exp=e,this.onUpdate=s,this.deps=new Set,this.value=this.getterTrigger()}addDep(t){t.subscribe(this),this.deps.add(t)}getterTrigger(){h.activated=this;const t=l(this.vm,this.exp);return h.activated=null,t}update(){const t=this.value,e=this.getterTrigger();t!==e&&(this.value=e,this.onUpdate.call(this.vm,e))}}class u{constructor(t,e,s,n){this.vm=e,this.node=s,this.exp=n;const{key:i,modifier:r}=function(t){const e=t.match(/^v-(\w+)(:(\w+))?$/);return{key:e[1],modifier:e[3]||null}}(t);this.modifier=r,this.template=s.textContent,0===t.indexOf("v-on")?this.eventHandler():this[i](),s instanceof HTMLElement&&s.removeAttribute(t)}bind(t){const e=this.modifier;"text"!==e&&"class"!==e&&"style"!==e||(t=o[e].bind(this)),t||(t=e?o.customBind.bind(this):o.objectBind.bind(this));const s=l(this.vm,this.exp);t&&t(this.node,s),new d(this.vm,this.exp,(e=>{t&&t(this.node,e)}))}model(){const t=this.node;switch(t.tagName){case"INPUT":{const e=t;"checkbox"===e.type?(e.addEventListener("change",(t=>{const e=t.target.checked;a(this.vm,this.exp,e)})),this.bind(o.inputCheckbox)):"radio"===e.type?(e.name=this.exp,e.addEventListener("change",(t=>{const e=t.target.value;a(this.vm,this.exp,e)})),this.bind(o.inputRadio)):(e.addEventListener("input",(t=>{const e=t.target.value;a(this.vm,this.exp,e)})),this.bind(o.inputValue));break}case"TEXTAREA":t.addEventListener("input",(t=>{const e=t.target.value;a(this.vm,this.exp,e)})),this.bind(o.inputValue);break;case"SELECT":{const e=t;e.multiple?(e.addEventListener("change",(t=>{const e=t.target,s=Array.from(e.selectedOptions).map((t=>t.value));a(this.vm,this.exp,s)})),this.bind(o.inputMultiple)):(e.addEventListener("change",(t=>{const e=t.target.value;a(this.vm,this.exp,e)})),this.bind(o.inputValue));break}default:throw new Error(`Unsupported element type: ${t.tagName}`)}}text(){this.bind(o.text.bind(this))}style(){this.bind(o.style)}class(){this.bind(o.class)}html(){this.bind(o.html)}eventHandler(){const t=c(this.vm,this.exp);"function"==typeof t&&this.node.addEventListener(this.modifier,t)}}class p{constructor(t,e){this.vm=t,this.node=e;const i=e.textContent;s(e)?this.directiveBind(e):n(e)&&/{{\s*(.*?)\s*}}/.test(i)&&!(t=>{const e=null==t?void 0:t.attributes;if(e)return Array.from(e).some((t=>"v-text"===t.name))})(e.parentElement)&&this.templateBind(e)}directiveBind(t){Array.from(t.attributes).forEach((({name:e,value:s})=>{r(e)&&new u(e,this.vm,t,s)}))}templateBind(t){i(t.textContent).forEach((e=>{new u("v-text",this.vm,t,e)}))}}class f{constructor(t){this.visitor=t}visit(t,e){this.visitor.visit(t,e)}}class m extends f{node2Fragment(t){const e=document.createDocumentFragment();let s;for(;s=t.firstChild;)e.appendChild(s);this.fragment=e}scan(t){const e=e=>{(t=>{if(s(t)){const e=t.attributes;return Array.from(e).some((t=>r(t.name)))}if(n(t))return!!i(t.textContent||"")})(e)&&new p(t,e)};t.template?(this.node2Fragment(t.template),t.el.innerHTML=""):this.node2Fragment(t.el),e(this.fragment),this.visit(e,this.fragment),t.el.appendChild(this.fragment)}}class v{visit(t,e){let s;const n=[e.firstChild];for(;s=n.pop();)s&&(t(s),s.firstChild&&n.push(s.firstChild),s.nextSibling&&n.push(s.nextSibling))}}class b{constructor(t){this.proxy=this.define(t)}define(e){const s=this,n=new Map,i=new Map;return new Proxy(e,{get(e,r,o){i.has(r)||i.set(r,new h),i.get(r).depend();const c=e[r];return t(c)?(n.has(r)||n.set(r,s.define(c)),n.get(r)):Reflect.get(e,r,o)},set(t,e,s,n){const r=Reflect.set(t,e,s,n);return i.has(e)&&i.get(e).notify(),r}})}}function g(t){const{data:e}=t.options,s="function"==typeof e?e():{},n=new b(s).proxy;for(const e in s)Object.defineProperty(t,e,{configurable:!1,get:()=>n[e],set:t=>{n[e]=t}});!function(t){const{methods:e}=t.options;if(!e)return;Object.entries(e).forEach((([e,s])=>{if(Object.hasOwn(t,e))throw new Error(`${e} has already been declared`);Object.defineProperty(t,e,{value:(...e)=>s.apply(t,e)})}))}(t),function(t){const{computed:e}=t.options;if(!e)return;for(const s in e)if(Object.hasOwn(t,s))throw new Error(`${s} has already been declared`);Object.entries(e).forEach((([e,s])=>{const n={};!function(t){return"function"!=typeof t}(s)?n.get=()=>s.call(t):(n.get=s.get.bind(t),n.set=(...e)=>{s.set.apply(t,e)}),Object.defineProperty(t,e,n)}))}(t)}class y{constructor(t){const e=t.cssRules.length;t.insertRule("*{}",e),this.rule=t.cssRules[e]}selector(t){this.rule.selectorText=t}setStyle(t,e){this.rule.style[t]=e}}class x{constructor(t){this.el=document.querySelector(t.el),this.options=t,this.template=function(t){if(!t)return;const e=document.createElement("div");return e.innerHTML=t,e.firstElementChild}(t.template),g(this),function(t){const{styles:e}=t.options;if(!e)return;const s=document.createElement("style");document.head.appendChild(s),Object.entries(e).forEach((([t,e])=>{const n=new y(s.sheet);n.selector(t),Object.entries(e).forEach((([t,e])=>{n.setStyle(t,e)}))}))}(this);new m(new v).scan(this)}}export{h as Dep,u as Directive,v as NodeVisitor,p as Observable,d as Observer,b as Reactivity,m as VueScanner,x as default,o as updaters};
